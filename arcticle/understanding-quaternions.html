<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>四元数理解 | ZYMIN</title><meta name="keywords" content="学习,数学"><meta name="author" content="ZYMIN"><meta name="copyright" content="ZYMIN"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="在这篇文章中我会尝试用简单的方式去解释四元数的概念，即用可视化的方式解释四元数以及几种对四元数的操作。我将把矩阵、欧拉角和四元数放在一起比较，并解释什么时候该用四元数、什么时候该用欧拉角或矩阵。  介绍 在计算机图形学中，我们使用转换矩阵来表示空间中的一个位置以及朝向。一个转换矩阵还可以表示对一个目标的缩放(scale)或错切(shear)等。 我们可以把转换矩阵想象成一个空间，当你用这个矩">
<meta property="og:type" content="article">
<meta property="og:title" content="四元数理解">
<meta property="og:url" content="https://zymin.cn/arcticle/understanding-quaternions.html">
<meta property="og:site_name" content="ZYMIN">
<meta property="og:description" content="在这篇文章中我会尝试用简单的方式去解释四元数的概念，即用可视化的方式解释四元数以及几种对四元数的操作。我将把矩阵、欧拉角和四元数放在一起比较，并解释什么时候该用四元数、什么时候该用欧拉角或矩阵。  介绍 在计算机图形学中，我们使用转换矩阵来表示空间中的一个位置以及朝向。一个转换矩阵还可以表示对一个目标的缩放(scale)或错切(shear)等。 我们可以把转换矩阵想象成一个空间，当你用这个矩">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg">
<meta property="article:published_time" content="2018-06-05T01:21:09.000Z">
<meta property="article:modified_time" content="2018-06-05T01:21:09.000Z">
<meta property="article:author" content="ZYMIN">
<meta property="article:tag" content="学习">
<meta property="article:tag" content="数学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/favicon.png"><link rel="canonical" href="https://zymin.cn/arcticle/understanding-quaternions"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//s4.cnzz.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?520b3c92f6cdaecc11a02bb0b6d128ef";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-175241210-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-175241210-1');
</script><script async="async" data-pjax="data-pjax" src="https://s4.cnzz.com/z_stat.php?id=1274310462&amp;web_id=1274310462"></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2018-06-05 09:21:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">287</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">158</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fas fa-music"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ZYMIN</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fas fa-music"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">四元数理解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2018-06-05T01:21:09.000Z" title="发表于 2018-06-05 09:21:09">2018-06-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2018-06-05T01:21:09.000Z" title="更新于 2018-06-05 09:21:09">2018-06-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>在这篇文章中我会尝试用简单的方式去解释四元数的概念，即用可视化的方式解释四元数以及几种对四元数的操作。我将把矩阵、欧拉角和四元数放在一起比较，并解释什么时候该用四元数、什么时候该用欧拉角或矩阵。</p>
<!---more--->
<h2 id="介绍">介绍</h2>
<p>在计算机图形学中，我们使用转换矩阵来表示空间中的一个位置以及朝向。一个转换矩阵还可以表示对一个目标的缩放(scale)或错切(shear)等。 我们可以把转换矩阵想象成一个空间，当你用这个矩阵乘以向量、点（甚至矩阵）后， 你就把向量、点、矩阵转换进这个空间了。</p>
<p>在这篇文章中，我不会讨论转换矩阵的细节。你可以查看我前面的文章，文章中描述了转换矩阵的细节。在这篇文章中，我想要讨论一个可替代的方案，即用四元数来描述空间里的物体的朝向。</p>
<p>四元数的概念是由爱尔兰数学家Sir William Rowan Hamilton发明的（1843年，都柏林）。Hamilton当时正和他的妻子前往爱尔兰皇家研究院，当他从Brougham桥通过皇家运河时，他领悟到了一个激动人心的东西，并立刻把它刻在桥的一个石头上：</p>
<p><span class="math display">\[\mathbf i^{2} = \mathbf j^{2} = \mathbf k^{2} =  \mathbf i \mathbf j \mathbf k = -1\]</span></p>
<h2 id="复数">复数</h2>
<p>在我们能够完全理解四元数之前，我们必须先知道四元数是怎么来的。四元数的根源其实是<strong>复数</strong>。除了知名的数集（自然数、整数、实数、分数）之外，复数系统引入了一个新的数集——虚数。虚数的发明是为了解决一些特定的无解的方程，例如：</p>
<p><span class="math display">\[x^{2} + 1 = 0\]</span></p>
<p><span class="math display">\[x^{2} = -1\]</span></p>
<p>一般而言，数学家是不能忍受一个等式是无解的。于是，一个新的术语被发明了，它就是虚数，一个可以解决上面这个等式的数。虚数有这样的形式：<span class="math inline">\(\mathbf i^{2} = -1\)</span></p>
<p>不要为这个术语较真，因为逻辑上这个数是不存在的。只要知道i是一个平方等于-1的东西即可。虚数的集合可以用<span class="math inline">\(\mathbb{I}\)</span>来表示。复数的集合<span class="math inline">\(\mathbb{C}\)</span>是一个实数和一个虚数的和，形式如下：</p>
<p><span class="math inline">\(z = a + b\mathbf i \ a,b\in R,\ \mathbf i^{2} = -1\)</span></p>
<p>可以认为所有实数都是b=0的复数、所有虚数都是a=0的复数。</p>
<h3 id="复数的加减">复数的加减</h3>
<p>加法：<span class="math inline">\((a_{1} + b_{1}\mathbf i) + (a_{2} + b_{2}\mathbf i) = (a_{1} + a_{2}) + (b_{1} + b_{2})\mathbf i\)</span></p>
<p>减法：<span class="math inline">\((a_{1} + b_{1}\mathbf i) - (a_{2} + b_{2}\mathbf i) = (a_{1} - a_{2}) + (b_{1} - b_{2})\mathbf i\)</span></p>
<h3 id="复数的系数缩放">复数的系数缩放</h3>
<p><span class="math display">\[\lambda (a_{1} + b_{1}\mathbf i) = \lambda  a_{1} + \lambda b_{1}\mathbf i\]</span></p>
<h3 id="复数的积">复数的积</h3>
<p><span class="math inline">\(z_{1} = (a_{1} + b_{1}\mathbf i)\)</span></p>
<p><span class="math inline">\(z_{2} = (a_{2} + b_{2}\mathbf i)\)</span></p>
<p><span class="math inline">\(z_{1}z_{2} = (a_{1} + b_{1}\mathbf i)(a_{2} + b_{2}\mathbf i) = a_{1}a_{2} + a_{1}b_{2}\mathbf i + b_{1}a_{2}\mathbf i + b_{1}b_{2}\mathbf i^{2}\)</span></p>
<p><span class="math inline">\(z_{1}z_{2} = (a_{1}a_{2} - b_{1}b_{2}) + (a_{1}b_{2} + b_{1}a_{2})\mathbf i\)</span></p>
<h3 id="复数的平方">复数的平方</h3>
<p><span class="math inline">\(z = (a + b\mathbf i)\)</span></p>
<p><span class="math inline">\(z^{2} = (a + b\mathbf i)(a + b\mathbf i)\)</span></p>
<p><span class="math inline">\(z^{2} = (a^{2} - b^{2}) + 2ab\mathbf i\)</span></p>
<h3 id="共轭复数">共轭复数</h3>
<p>复数的共轭就是指把复数的虚数部分变成负的。共轭复数的符号是z或z^{*}。</p>
<p><span class="math inline">\(z = (a + b\mathbf i)\)</span></p>
<p><span class="math inline">\(z^{*} = (a - b\mathbf i)\)</span></p>
<p>复数和它的共轭复数的乘积是：</p>
<p><span class="math inline">\(zz^{*} = (a + b\mathbf i)(a - b\mathbf i) = a^{2}-ab\mathbf i + ab\mathbf i + b^{2} = a^{2}+b^{2}\)</span></p>
<h3 id="复数的绝对值">复数的绝对值</h3>
<p>我们使用共轭复数来计算复数的绝对值：</p>
<p><span class="math inline">\(z = (a + b\mathbf i)\)</span></p>
<p><span class="math inline">\(|z| = \sqrt {zz^{*}} = \sqrt {(a + b\mathbf i)(a - b\mathbf i)} = \sqrt {a^{2} + b^{2} }\)</span></p>
<h3 id="两复数的商">两复数的商</h3>
<p><span class="math inline">\(z_{1} = (a_{1} + b_{1}\mathbf i)\)</span></p>
<p><span class="math inline">\(z_{2} = (a_{2} + b_{2}\mathbf i)\)</span></p>
<p><span class="math display">\[\frac {z_{1}}{z_{2}} = \frac {a_{1} + b_{1}\mathbf i}{a_{2} + b_{2}\mathbf i} = \frac {(a_{1} + b_{1}\mathbf i)(a_{2} - b_{2}\mathbf i)}{(a_{2} + b_{2}\mathbf i)(a_{2} - b_{2}\mathbf i)}= \frac {a_{1}a_{2}-a_{1}b_{2}\mathbf i+b_{1}a_{2}\mathbf i-b_{1}b_{2}\mathbf i^{2} }{a_{2}^{2} + b_{2}^{2}}= \frac {a_{1}a_{2} + b_{1}b_{2} }{a_{2}^{2} + b_{2}^{2}}   + \frac {b_{1}a_{2} - a_{1}b_{2} }{a_{2}^{2} + b_{2}^{2}}\mathbf i\]</span></p>
<h2 id="i的幂">i的幂</h2>
<p>如果<span class="math inline">\(\mathbf i\)</span>的平方等于-1，那么<span class="math inline">\(\mathbf i\)</span>的n次幂也应该存在：</p>
<p><span class="math inline">\(\mathbf i^{0} = 1\)</span></p>
<p><span class="math inline">\(\mathbf i^{1} = \mathbf i\)</span></p>
<p><span class="math inline">\(\mathbf i^{2} = -1\)</span></p>
<p><span class="math inline">\(\mathbf i^{3} = \mathbf i\mathbf i^{2} = -i\)</span></p>
<p><span class="math inline">\(\mathbf i^{4} = \mathbf i^{2}\mathbf i^{2} = 1\)</span></p>
<p><span class="math inline">\(\mathbf i^{5} = \mathbf i \mathbf i^{4} = i\)</span></p>
<p><span class="math inline">\(\mathbf i^{6} = \mathbf i\mathbf i^{5} = \mathbf i^{2} = -1\)</span></p>
<p>如果按照这个顺序写下去，会出现这样一个模式：$ (1,i,-1,-i,1,...)$</p>
<p>一个类似的模式也出现在递增的负数幂：</p>
<p><span class="math inline">\(\mathbf i^{0} = 1\)</span></p>
<p><span class="math inline">\(\mathbf i^{-1} = -i\)</span></p>
<p><span class="math inline">\(\mathbf i^{-2} = -1\)</span></p>
<p><span class="math inline">\(\mathbf i^{-3} = i\)</span></p>
<p><span class="math inline">\(\mathbf i^{-4} = 1\)</span></p>
<p><span class="math inline">\(\mathbf i^{-5} = -i\)</span></p>
<p><span class="math inline">\(\mathbf i^{-6} = -1\)</span></p>
<p>你可能已经在数学里头见过类似的模式，但是是以<span class="math inline">\(（x,y,-x,-y,x,...)\)</span>的形式，这是在2D笛卡尔平面对一个点逆时针旋转90度时生成的；<span class="math inline">\(（x,-y,-x,y,x,...)\)</span>则是在2D笛卡尔平面对一个点顺时针旋转90度时生成的。</p>
<p><img src="https://www.qiujiawei.com/images/2015.9/3.png" /></p>
<h2 id="复数平面">复数平面</h2>
<p>我们也能够把复数映射到一个2D网格平面——复数平面，只需要把实数映射到横轴、虚数映射到纵轴。</p>
<p><img src="https://www.qiujiawei.com/images/2015.9/4.png" /></p>
<p>如前面的序列所示，我们可以认为，对一个复数乘以i，这个复数就在复数平面上旋转了90度。</p>
<p>让我们看看这是不是真的。我们随机地在复数平面上取一个点：</p>
<p><span class="math inline">\(p = 2 + \mathbf i\)</span></p>
<p>p乘以i后得到q：</p>
<p><span class="math inline">\(q = p\mathbf i = (2+\mathbf i)\mathbf i = 2\mathbf i + \mathbf i^{2} = -1 + 2\mathbf i\)</span></p>
<p>q乘以i后得到r：</p>
<p><span class="math inline">\(r = q\mathbf i = (-1 + 2\mathbf i)\mathbf i = -\mathbf i + 2\mathbf i^{2} = -2 -\mathbf i\)</span></p>
<p>r乘以i后得到s：</p>
<p><span class="math inline">\(s = r\mathbf i = (-2 - \mathbf i)\mathbf i = -2\mathbf i-\mathbf i^{2} = 1 - 2\mathbf i\)</span></p>
<p>s乘以i后得到t：</p>
<p><span class="math inline">\(t = s\mathbf i = (1-2\mathbf i)\mathbf i = \mathbf i - 2\mathbf i^{2} = 2 + \mathbf i\)</span></p>
<p>t刚好是开始的p。如果我们把这些复数放到复数平面上，就得到下面的图：</p>
<p><img src="https://www.qiujiawei.com/images/2015.9/5.png" /></p>
<p>我们也可以按顺时针方向旋转，只需要把上面的乘数i改成-i。</p>
<h3 id="旋转数rotors">旋转数（Rotors)</h3>
<p>我们也可以在复数平面上进行任意角度的旋转，只需要定义下面这个复数：</p>
<p><span class="math inline">\(q = cos\theta + \mathbf i sin\theta\)</span></p>
<p>任意的复数乘以q：</p>
<p><span class="math inline">\(p = a + b\mathbf i\)</span></p>
<p><span class="math inline">\(q = cos\theta + \mathbf i sin\theta\)</span></p>
<p><span class="math inline">\(pq = (a + b\mathbf i)(cos\theta + \mathbf i sin\theta )\)</span></p>
<p><span class="math inline">\(a&#39; + b&#39;\mathbf i = acos\theta -bsin\theta + (asin\theta +bcos\theta )\mathbf i\)</span></p>
<p>也可以写成矩阵的形式：</p>
<p><span class="math display">\[\left[ \begin{matrix} a&#39;&amp;-b&#39;\\ b&#39;&amp;a&#39;\\ \end{matrix} \right] =  \left[ \begin{matrix} cos\theta &amp;-sin\theta \\ sin\theta &amp;cos\theta \\ \end{matrix} \right] \left[ \begin{matrix} a&amp;-b\\ b&amp;a\\ \end{matrix} \right]\]</span></p>
<p>这也是一个在复数平面绕原点逆时针旋转任意点的方法。（译注：这句话应该是在说旋转矩阵）</p>
<h2 id="四元数">四元数</h2>
<p>了解了复数系统和复数平面后，我们可以额外增加2个虚数到我们的复数系统，从而把这些概念拓展到3维空间。</p>
<p>四元数的一般形式：</p>
<p><span class="math inline">\(q = s + x\mathbf i + y\mathbf j + z\mathbf k \ \ \ s,x,y,z \in \mathbb{R}\)</span></p>
<p>上面的公式是根据Hamilton的著名的表达式得到的：</p>
<p><span class="math inline">\(\mathbf i^{2} = \mathbf j^{2} = \mathbf k^{2} = \mathbf i\mathbf j\mathbf k = -1\)</span></p>
<p>以及：</p>
<p><span class="math display">\[\mathbf i \mathbf j = \mathbf k \\ \mathbf j \mathbf k = \mathbf i  \\ \mathbf k \mathbf i = \mathbf j\]</span></p>
<p><span class="math display">\[\mathbf j \mathbf i = -\mathbf k \\ \mathbf k \mathbf j = -\mathbf i \\ \mathbf i \mathbf k = -\mathbf j\]</span></p>
<p>你可能已经注意到了，i、j、k之间的关系非常像笛卡尔坐标系下单位向量的叉积规则：</p>
<p><span class="math display">\[\mathbf x\times \mathbf y = \mathbf z \\ \mathbf y\times \mathbf z = \mathbf x \\ \mathbf z\times \mathbf x = \mathbf y\]</span></p>
<p><span class="math display">\[\mathbf y\times \mathbf x = -\mathbf z \\ \mathbf z\times \mathbf y = -\mathbf x \\ \mathbf x\times \mathbf z = -\mathbf y\]</span></p>
<p>Hamilton自己也发现i、j、k虚数可以被用来表达3个笛卡尔坐标系单位向量i、j、k，并且仍然保持有虚数的性质，也即<span class="math inline">\(\mathbf i^{2} = \mathbf j^{2} = \mathbf k^{2} = -1\)</span>。</p>
<p><img src="https://www.qiujiawei.com/images/2015.9/6.png" />（<span class="math inline">\(\mathbf i \mathbf j, \mathbf j \mathbf k, \mathbf k \mathbf i\)</span>这几个性质的可视化）</p>
<p>上图展示了如何用i、j、k作为笛卡尔坐标系的单位向量。</p>
<h3 id="作为有序数的四元数">作为有序数的四元数</h3>
<p>我们可以用有序对的形式，来表示四元数：</p>
<p><span class="math inline">\([s,\mathbf {v}] \ \ \ s\in \mathbb{R},v\in \mathbb{R^{3}}\)</span></p>
<p>其中的v，也可以用它各自独立的3个分量表示：</p>
<p><span class="math inline">\(q = [s,x\mathbf i + y\mathbf j + z\mathbf k] \ \ \ s,x,y,z\in \mathbb{R}\)</span></p>
<p>使用这种表示法，我们可以更容易地展示四元数和复数之间的相似性。</p>
<h3 id="四元数的加减">四元数的加减</h3>
<p>和复数类似，四元数也可以被加减：</p>
<p><span class="math inline">\(q_{a} = [s_{a},\mathbf {a}]\)</span></p>
<p><span class="math inline">\(q_{b} = [s_{b},\mathbf {b}]\)</span></p>
<p><span class="math inline">\(q_{a} + q_{b} = [s_{a} + s_{b},\mathbf {a} + \mathbf {b}]\)</span></p>
<p><span class="math inline">\(q_{a} - q_{b} = [s_{a} - s_{b},\mathbf {a} - \mathbf {b}]\)</span></p>
<h3 id="四元数的积">四元数的积</h3>
<p>我们也可以表示四元数的乘积：</p>
<p><span class="math display">\[\begin{align} q_{a}q_{b} &amp;= [s_{a},\mathbf {a}][s_{b},\mathbf {b}]\\&amp;= (s_{a} + x_{a}\mathbf i + y_{a}\mathbf j +z_{a}\mathbf k)(s_{b} + x_{b}\mathbf i + y_{b}\mathbf j +z_{b}\mathbf k)\\&amp;= (s_{a}s_{b} - x_{a}x_{b} - y_{a}y_{b} - z_{a}z_{b})+(s_{a}x_{b} + s_{b}x_{a} \\&amp;+ y_{a}z_{b} - y_{b}z_{a})\mathbf i +(s_{a}y_{b}+s_{b}y_{a}+z_{a}x_{b}-z_{b}x_{a})\mathbf j  \\&amp;+ (s_{a}z_{b}+s_{b}z_{a}+x_{a}y_{b}-x_{b}y_{a})\mathbf k\end{align}\]</span></p>
<p>可以看到，四元数的乘积依然还是一个四元数。如果我们把虚数<span class="math inline">\(\mathbf i​\)</span>、<span class="math inline">\(\mathbf j​\)</span>、<span class="math inline">\(\mathbf k​\)</span>替换成有序对：</p>
<p><span class="math inline">\(\mathbf i = [0, \mathbf i]\ \ \  \mathbf j = [0, \mathbf j]\ \ \  \mathbf k = [0, \mathbf k]\)</span></p>
<p>以及还有[1,0] = 1，将它们代入前面的表达式，就得到了：</p>
<p><span class="math display">\[\begin{align}q_{a}q_{b} &amp;= (s_{a}s_{b} - x_{a}x_{b} - y_{a}y_{b} - z_{a}z_{b})[1,\mathbf 0]\\&amp;+ (s_{a}x_{b} + s_{b}x_{a} + y_{a}z_{b} - y_{b}z_{a})[0,\mathbf i]\\&amp;+ (s_{a}y_{b}+s_{b}y_{a}+z_{a}x_{b}-z_{b}x_{a})[0,\mathbf j]\\&amp;+ (s_{a}z_{b}+s_{b}z_{a}+x_{a}y_{b}-x_{b}y_{a})[0,\mathbf k]\end{align}\]</span></p>
<p>再把这个表达式扩展成多个有序对的和：</p>
<p><span class="math display">\[\begin{align}q_{a}q_{b} &amp;= [(s_{a}s_{b} - x_{a}x_{b} - y_{a}y_{b} - z_{a}z_{b}),\mathbf 0]\\&amp;+ [0,(s_{a}x_{b} + s_{b}x_{a} + y_{a}z_{b} - y_{b}z_{a})\mathbf i]\\&amp;+ [0,(s_{a}y_{b}+s_{b}y_{a}+z_{a}x_{b}-z_{b}x_{a})\mathbf j]\\&amp;+ [0,(s_{a}z_{b}+s_{b}z_{a}+x_{a}y_{b}-x_{b}y_{a})\mathbf k]\end{align}\]</span></p>
<p>如果把后3个四元数相加，并提取公共部分，就可以把等式改写成：</p>
<p><span class="math display">\[\begin{align} q_{a}q_{b} &amp;= [(s_{a}s_{b} - x_{a}x_{b} - y_{a}y_{b} - z_{a}z_{b}),\mathbf 0]\\&amp;+ [0,s_{a}(x_{b}\mathbf i + y_{b}\mathbf j + z_{b}\mathbf k) + s_{b}(x_{a}\mathbf i + y_{a}\mathbf j + z_{a}\mathbf k)\\&amp;+(y_{a}z_{b}-y_{b}z_{a})\mathbf i + (z_{a}x_{b}-z_{b}x_{a})\mathbf j + (x_{a}y_{b}-x_{b}y_{a})\mathbf k]\end{align} \]</span></p>
<p>这个等式是2个有序对的和。第1个有序对是一个<strong>实</strong>四元数，第2个是一个<strong>纯</strong>四元数。这两个四元数也可以合并成一个：</p>
<p><span class="math display">\[\begin{align}q_{a}q_{b} &amp;= [(s_{a}s_{b} - x_{a}x_{b} - y_{a}y_{b} - z_{a}z_{b}),s_{a}(x_{b}\mathbf i + y_{b}\mathbf j+z_{b}\mathbf k) \\&amp;+ s_{b}(x_{a}\mathbf i+y_{a}\mathbf j+z_{a}\mathbf k)+(y_{a}z_{b}-y_{b}z_{a})\mathbf i+(z_{a}x_{b}-z_{b}x_{a})\mathbf j+(x_{a}y_{b}-x_{b}y_{a})\mathbf k]\end{align}\]</span></p>
<p>如果把下面的表达式代入上面的等式：</p>
<p><span class="math inline">\(\mathbf a = x_{a}\mathbf i + y_{a}\mathbf j + z_{a}\mathbf k\)</span></p>
<p><span class="math inline">\(\mathbf b = x_{b}\mathbf i + y_{b}\mathbf j + z_{b}\mathbf k\)</span></p>
<p><span class="math inline">\(\mathbf a\cdot \mathbf b = x_{a}x_{b} + y_{a}y_{b} + z_{a}z_{b}\)</span></p>
<p><span class="math inline">\(\mathbf a\times \mathbf b = (y_{a}z_{b}-y_{b}z_{a})\mathbf i + (z_{a}x_{b} - z_{b}x_{a})\mathbf j + (x_{a}y_{b} - x_{b}y_{a})\mathbf k\)</span></p>
<p>（译注：注意，第三条和第四条并不是四元数的点积和叉积，而是向量的点积和叉积）</p>
<p>我们就得到了：</p>
<p><span class="math inline">\(q_{a}q_{b} = [s_{a}s_{b} - \mathbf a\cdot \mathbf b, s_{a}\mathbf b + s_{b}\mathbf a + \mathbf a\times \mathbf b]\)</span></p>
<p>这就是四元数乘积的一般式。</p>
<h3 id="实四元数">实四元数</h3>
<p>一个实四元数是一个虚部向量为零向量的四元数：</p>
<p><span class="math inline">\(q = [s,\mathbf {0}]\)</span></p>
<p>两个实四元数的乘积是另一个实四元数：</p>
<p><span class="math inline">\(q_{a} = [s_{a},\mathbf {0}]\)</span></p>
<p><span class="math inline">\(q_{b} = [s_{b},\mathbf {0}]\)</span></p>
<p><span class="math inline">\(q_{a}q_{b} = [s_{a},\mathbf {0}][s_{b},\mathbf {0}] = [s_{a}s_{b},\mathbf {0}]\)</span></p>
<p>这和2个虚部为0的复数的乘积几乎一样：</p>
<p><span class="math inline">\(z_{1} = a_{1} + 0\mathbf i\)</span></p>
<p><span class="math inline">\(z_{2} = a_{2} + 0\mathbf i\)</span></p>
<p><span class="math inline">\(z_{1}z_{2} = (a_{1} + 0\mathbf i)(a_{2} + 0\mathbf i) = a_{1}a_{2}\)</span></p>
<h3 id="四元数的系数缩放">四元数的系数缩放</h3>
<p>我们也可以用一个系数（实数）去乘四元数：</p>
<p><span class="math inline">\(q = [s,\mathbf {v}]\)</span></p>
<p><span class="math inline">\(\lambda q = \lambda [s,\mathbf {v}] = [\lambda s,\lambda \mathbf {v}]\)</span></p>
<p>我们可以用实四元数与普通四元数的乘积，来确认这个等式是否正确：</p>
<p><span class="math inline">\(q = [s,\mathbf {v}]\)</span></p>
<p><span class="math inline">\(\lambda = [\lambda ,0]\)</span></p>
<p><span class="math inline">\(\lambda q = [\lambda ,\mathbf {0}][s,\mathbf {v}] = [\lambda s,\lambda v]\)</span></p>
<h3 id="纯四元数">纯四元数</h3>
<p>和实四元数相似，Hamilton也定义了纯四元数。纯四元数是s=0的四元数：</p>
<p><span class="math inline">\(q = [0,\mathbf { v }]\)</span></p>
<p>也可以写成下面的形式：</p>
<p><span class="math inline">\(q = x\mathbf { i } + y\mathbf { k } + z\mathbf { k }\)</span></p>
<p>然后是2个纯四元数的乘积：</p>
<p><span class="math inline">\(q_{a} = [0,\mathbf { a }]\)</span></p>
<p><span class="math inline">\(q_{b} = [0,\mathbf { b }]\)</span></p>
<p><span class="math inline">\(q_{a}q_{b} = [0,\mathbf { a }][0, \mathbf { b }] = [-\mathbf { a }\cdot \mathbf { b }, \mathbf { a }\times \mathbf { b }]\)</span></p>
<h3 id="四元数的加法形式">四元数的加法形式</h3>
<p>我们可以把四元数写成实四元数和纯四元数的和：</p>
<p><span class="math inline">\(q = [s, \mathbf { v }]= [s, \mathbf { 0 }] + [0, \mathbf { v }]\)</span></p>
<h3 id="单位四元数">单位四元数</h3>
<p>给定任意的向量v，我们可以把这个向量写成一个系数和一个单位方向向量的乘积：</p>
<p><span class="math inline">\(\mathbf { v } = v\mathbf { \hat { \mathbf v } } \ \  v = |\mathbf {v}|,|\mathbf { \hat { \mathbf v } }|=1\)</span></p>
<p>将这个定义和纯四元数的定义结合，就得到了：</p>
<p><span class="math inline">\(q = [0,\mathbf { v }]= [0, v \mathbf { \hat { \mathbf v } }]= v[0, \mathbf { \hat { \mathbf v } }]\)</span></p>
<p>然后，我们可以定义单位四元数了，它是一个s=0、为单位向量的四元数：</p>
<p><span class="math inline">\(\hat {q} = [0, \mathbf { \hat { \mathbf v } }]\)</span></p>
<h3 id="四元数的二元形式">四元数的二元形式</h3>
<p>我们现在可以把单位四元数的定义和四元数的加法形式结合到一起，就创造了一种新的四元数的表示法，这种表示法和复数的表示法形似：</p>
<p><span class="math inline">\(q = [s,\mathbf { v }]= [s,\mathbf { 0 }] + [0, \mathbf { v }]= [s,\mathbf { 0 }] + v [0,\mathbf { \hat { \mathbf v }}]= s + v \mathbf {\hat {q} }\)</span></p>
<p>这就给了我们一种和复数非常相似的四元数表示法：</p>
<p><span class="math inline">\(z = a + b \mathbf {i}\)</span></p>
<p><span class="math inline">\(q = s + v \mathbf {\hat {q}}\)</span></p>
<h3 id="共轭四元数">共轭四元数</h3>
<p>共轭四元数的计算，就是将四元数的虚向量取反：</p>
<p><span class="math inline">\(q = [s,\mathbf {v}]\)</span></p>
<p><span class="math inline">\(q^{*} = [s,-\mathbf {v}]\)</span></p>
<p>四元数和它的共轭四元数的乘积：</p>
<p><span class="math inline">\(\begin{align}qq^{*} &amp;= [s,\mathbf {v}][s,-\mathbf {v}]\\&amp;= [s^{2} - \mathbf {v}\cdot (-\mathbf {v}),-s\mathbf {v}+s\mathbf {v}+\mathbf {v}\times (-\mathbf {v})]\\&amp;= [s^{2} + \mathbf {v}\cdot \mathbf {v}, \mathbf {0}]\\&amp;= [s^{2} + \mathbf {v}^{2}, \mathbf {0}]\end{align}\)</span></p>
<h3 id="四元数范数">四元数范数</h3>
<p>回忆下复数范数的定义：</p>
<p><span class="math inline">\(|z| = \sqrt {a^{2}+b^{2}}\)</span></p>
<p><span class="math inline">\(zz^{*} = |z|^{2}\)</span></p>
<p>类似的，四元数的范数可以这样定义：</p>
<p><span class="math inline">\(\mathbf q = [s,\mathbf {v}]\)</span></p>
<p><span class="math inline">\(|\mathbf q| = \sqrt {s^{2} + v^{2}}\)</span></p>
<p>这也让我们可以这样表达四元数范数：</p>
<p><span class="math inline">\(\mathbf q\mathbf q^{*} = |\mathbf q|^{2}\)</span></p>
<h3 id="四元数规范化">四元数规范化</h3>
<p>利用四元数范数的定义，就可以对四元数进行规范化。要让一个四元数规范化，只需要让这个四元数去除以它的范数：</p>
<p><span class="math inline">\(\mathbf q&#39; = \frac {\mathbf q}{\sqrt {s^{2}+v^{2}}}\)</span></p>
<p>举一个例子，让我们规范化下面这个四元数：</p>
<p><span class="math inline">\(\mathbf q = [1, 4\mathbf i + 4\mathbf j - 4\mathbf k]\)</span></p>
<p>第一步，先计算q的范数：</p>
<p><span class="math inline">\(|\mathbf q| = \sqrt {1^{2}+4^{2}+4^{2}+(-4)^{2}}= \sqrt {49} = 7\)</span></p>
<p>然后，q除以|q|:</p>
<p><span class="math inline">\(\begin{align}\mathbf q&#39; &amp;= \frac {\mathbf q}{|\mathbf q|}\\&amp;= \frac {(1+4\mathbf i+4\mathbf j-4\mathbf k)}{7}\\&amp;= \frac {1}{7}+\frac {4}{7}\mathbf i+\frac {4}{7}\mathbf j-\frac {4}{7}\mathbf k\end{align}\)</span></p>
<h3 id="四元数的逆">四元数的逆</h3>
<p>四元数的逆用<span class="math inline">\(\mathbf q^{-1}\)</span>表示。要计算四元数的逆，需要用四元数的共轭四元数去除以四元数的范数的平方：</p>
<p><span class="math inline">\(\mathbf q^{-1} = \frac {\mathbf q^{*}}{|\mathbf q|^{2} }\)</span></p>
<p>为了证明这个式子，我们先根据<strong>逆</strong>的定义，有：</p>
<p><span class="math inline">\(\mathbf q\mathbf q^{-1} = [1,\mathbf 0] = 1\)</span></p>
<p>两边都左乘共轭四元数$q^{*} $:</p>
<p><span class="math inline">\(\mathbf q^{ * }\mathbf q\mathbf q^{ -1 } = \mathbf q^{ * }\)</span></p>
<p>将上文中的<span class="math inline">\(\mathbf q\mathbf q^{*} = |\mathbf q|^{2}\)</span>代入这个式子，得到：</p>
<p><span class="math inline">\(|\mathbf q|^{2}\mathbf q^{-1} = \mathbf q^{*}\)</span></p>
<p><span class="math inline">\(\mathbf q^{-1} = \frac {\mathbf q^{*}}{|\mathbf q|^{2}}\)</span></p>
<p>对于单位四元数，它的范数是1，所以可以写成：</p>
<p><span class="math inline">\(\mathbf q^{-1} = \mathbf q^{*}\)</span></p>
<h3 id="四元数的点积">四元数的点积</h3>
<p>和向量的点积相似，我们也可以计算2个四元数的点积，只需要将各个对应的系数相乘，然后相加:</p>
<p><span class="math inline">\(\mathbf q_{1} = [s_{1},x_{1}\mathbf i+y_{1}\mathbf j+z_{1}\mathbf k]\)</span></p>
<p><span class="math inline">\(\mathbf q_{2} = [s_{2},x_{2}\mathbf i+y_{2}\mathbf j+z_{2}\mathbf k]\)</span></p>
<p><span class="math inline">\(\mathbf q_{1}\cdot \mathbf q_{2} = s_{1}s_{2}+x_{1}x_{2}+y_{1}y_{2}+z_{1}z_{2}\)</span></p>
<p>我们也可以利用四元数点积，来计算四元数之间的角度差：</p>
<p><span class="math inline">\(cos\theta = \frac {s_{1}s_{2}+x_{1}x_{2}+y_{1}y_{2}+z_{1}z_{2}}{|\mathbf q_{1}||\mathbf q_{2}|}\)</span></p>
<p>对于单位四元数，我们可以简化上面的等式：</p>
<p><span class="math inline">\(cos\theta = s_{1}s_{2}+x_{1}x_{2}+y_{1}y_{2}+z_{1}z_{2}\)</span></p>
<h2 id="旋转">旋转</h2>
<p>前面我们定义了一个特殊的复数：旋转数。它是用来旋转2D复数平面的点的：</p>
<p><span class="math inline">\(\mathbf q = cos\theta + \mathbf i sin\theta\)</span></p>
<p>根据四元数和复数的相似性，应该有可能设计一个可以旋转3D空间的点的四元数：</p>
<p><span class="math inline">\(\mathbf q = [cos\theta, sin\theta \mathbf {v}]\)</span></p>
<p>让我们测试一下这个理论是否可靠，方法就是计算四元数q和向量p的积。第一步，我们把p写成纯四元数的形式：</p>
<p><span class="math inline">\(\mathbf p = [0,\mathbf {p}]\)</span></p>
<p>以及单位四元数q：</p>
<p><span class="math inline">\(\mathbf q = [s,\lambda \mathbf {\hat { \mathbf v }}]\)</span></p>
<p>从而：</p>
<p><span class="math display">\[\begin{align}\mathbf p&#39; &amp;= \mathbf q\mathbf p \\ &amp;= [s,\lambda \mathbf {\hat { \mathbf v }}] [0,\mathbf {p}]\\&amp;=  [-\lambda \mathbf {\hat { \mathbf v }}\cdot \mathbf {p}, s\mathbf {p} + \lambda \mathbf {\hat { \mathbf v }}\times \mathbf {p} ]\end{align}\]</span></p>
<p>我们可以看到结果是一个同时有系数、有虚向量的四元数。</p>
<p>让我们先考虑特殊的情形：<span class="math inline">\(\mathbf {p}\)</span>与<span class="math inline">\(\mathbf {\hat { \mathbf v }}\)</span>正交。这种情况下，点乘部分等于0：<span class="math inline">\(-\lambda \mathbf {\hat { \mathbf v }}\cdot \mathbf {p} = 0\)</span>。所以上面的四元数就变成了纯四元数：</p>
<p><span class="math inline">\(p&#39; = [0, s\mathbf {p} + \lambda \mathbf {\hat { \mathbf v }}\times \mathbf {p}]\)</span></p>
<p>这时候，要使<span class="math inline">\(\mathbf {p}\)</span>绕<span class="math inline">\(\mathbf {\hat { \mathbf v }}\)</span>旋转，我们只需要代入<span class="math inline">\(s=cos\theta\)</span>和<span class="math inline">\(\lambda =sin\theta\)</span>：</p>
<p><span class="math inline">\(p&#39; = [0, cos\theta \mathbf {p} + sin\theta \mathbf {\hat { \mathbf v }}\times \mathbf {p}]\)</span></p>
<p>现在，让我们找一个例子来测试上面的公式。譬如绕z轴(就是k轴)旋转45度，那么我们的四元数q就变成：</p>
<p><span class="math inline">\(q = [cos\theta ,sin\theta \mathbf {k}]= [\frac {\sqrt {2}}{2},\frac {\sqrt {2}}{2}\mathbf {k}]\)</span></p>
<p>然后，选一个特殊的p，并且p要和k轴正交，譬如把p放到i轴上，也就是：</p>
<p><span class="math inline">\(p = [0, 2\mathbf {i}]\)</span></p>
<p>好了，现在计算下qp：</p>
<p><span class="math inline">\(\mathbf p&#39; = \mathbf q\mathbf p= [\frac {\sqrt {2}}{2},\frac {\sqrt {2}}{2}\mathbf {k}][0,2\mathbf {i}]= [0,2\frac {\sqrt {2}}{2}\mathbf {i} + 2\frac {\sqrt {2}}{2}\mathbf {k}\times \mathbf {i}]= [0, \sqrt {2}\mathbf {i} + \sqrt {2}\mathbf {j}]\)</span></p>
<p>结果是一个绕了k轴转了45度的纯四元数。 我们可以确认这个四元数的向量部分的长度是：</p>
<p><span class="math inline">\(\mathbf p&#39; = \sqrt { \sqrt {2}^{2} + \sqrt {2}^{2} } = 2\)</span></p>
<p>这正是我们所期望的！</p>
<p>我们可以用图像展示旋转过程：</p>
<figure>
<img src="https://www.qiujiawei.com/images/2015.9/7.png" alt="" /><figcaption>7.png</figcaption>
</figure>
<p>现在，让我们考虑更一般化的四元数，即和p不正交的四元数。现在让我们把p的向量部分偏移45度：</p>
<p><span class="math inline">\(\hat { \mathbf v } = \frac {\sqrt {2}}{2}\mathbf {i} + \frac {\sqrt {2}}{2}\mathbf {k}\mathbf {p} = 2\mathbf {i}\)</span></p>
<p><span class="math inline">\(q = [cos\theta , sin\theta \mathbf {\hat { \mathbf v }} ]\)</span></p>
<p><span class="math inline">\(p = [0, \mathbf {p}]\)</span></p>
<p>然后算qp：</p>
<p><span class="math inline">\(\mathbf p&#39; = \mathbf q\mathbf p= [cos\theta ,sin\theta \mathbf { \hat { \mathbf v } }][0, \mathbf {p} ][-sin\theta \hat { \mathbf v }\cdot \mathbf {p}, cos\theta \mathbf {p}+sin\theta \mathbf { \hat { \mathbf v } }\times \mathbf {p}]\)</span></p>
<p>代入我们设定的<span class="math inline">\(\mathbf { \hat { \mathbf v } }, \mathbf {p}\)</span>，以及<span class="math inline">\(\theta = 45^{\circ }\)</span>，得到：</p>
<p><span class="math display">\[p&#39; = [-\frac {\sqrt {2}}{2}(\frac {\sqrt {2}}{2}\mathbf {i}  + \frac {\sqrt {2}}{2}\mathbf {k} )\cdot (2\mathbf {i} ), \frac {\sqrt {2}}{2}2\mathbf {i} +\frac {\sqrt {2}}{2}(\frac {\sqrt {2}}{2}\mathbf {i}  + \frac {\sqrt {2}}{2}\mathbf {k} )\times 2\mathbf {i} ]= [-1, \sqrt {2}\mathbf {i}  + \mathbf {j} ]\sqrt {3}\]</span></p>
<p>我们可以用图像展示旋转过程：</p>
<figure>
<img src="https://www.qiujiawei.com/images/2015.9/8.png" alt="" /><figcaption>8.png</figcaption>
</figure>
<blockquote>
<p>严格来说，这样子在3维空间中表示p'是不正确的。因为它其实是一个4维的向量！为了简单起见，我只将这个四元数的向量部分显示出来。</p>
</blockquote>
<p>然而，还有一线生机。Hamilton发现（但没有正式宣布），如果对qp右乘q的逆，出来的结果是一个纯四元数，并且四元数向量部分的范数可以保持不变。让我们试试应用在我们的例子里。</p>
<p>首先计算:</p>
<p><span class="math inline">\(\mathbf q = [cos\theta , sin\theta (\frac {\sqrt {2}}{2}\mathbf {i} + \frac {\sqrt {2}}{2}\mathbf {k})]\)</span></p>
<p><span class="math inline">\(\mathbf q^{-1} = [cos\theta , -sin\theta (\frac {\sqrt {2}}{2}\mathbf {i} + \frac {\sqrt {2}}{2}\mathbf {k})]\)</span></p>
<p>(译注：这里<span class="math inline">\(\mathbf q^{-1}=\mathbf q^{*}\)</span>是因为q是单位四元数)</p>
<p>再代入<span class="math inline">\(\theta = 45^{\circ }\)</span>，得到：</p>
<p><span class="math display">\[\mathbf q^{-1} =  [\frac {\sqrt {2}}{2},  -\frac {\sqrt {2}}{2}(\frac {\sqrt {2}}{2}\mathbf {i} + \frac {\sqrt {2}}{2}\mathbf {k})]\frac {1}{2}[\sqrt {2}, -\mathbf {i}-\mathbf {k}]\]</span></p>
<p>现在，把前面算出来的qp再次拿出来：</p>
<p><span class="math inline">\(\mathbf q\mathbf p = [-1, \sqrt {2}\mathbf {i} + \mathbf {j}]\)</span></p>
<p><span class="math display">\[\begin{align}qpq^{-1}  &amp;= [-1, \sqrt {2}\mathbf {i} + \mathbf {j}]\frac {1}{2}[\sqrt {2}, -\mathbf {i}-\mathbf {k}] \\ &amp;= \frac {1}{2}[-\sqrt {2}-(\sqrt {2}\mathbf {i}+\mathbf {j})\cdot (-\mathbf {i}-\mathbf {k}), \mathbf {i}+\mathbf {k}+\sqrt {2}(\sqrt {2}\mathbf {i}+\mathbf {j})-\mathbf {i}+\sqrt {2}\mathbf {j}+\mathbf {k}]\\ &amp;= \frac {1}{2}[-\sqrt {2}+\sqrt {2},\mathbf {i}+\mathbf {k}+2\mathbf {i}+\sqrt {2}\mathbf {j}-\mathbf {i}+\sqrt {2}\mathbf {j}+\mathbf {k}]\\ &amp;= [0,\mathbf {i}+\sqrt {2}\mathbf {j}+\mathbf {k}]\end{align}\]</span></p>
<p>这下是纯四元数了，并且它的范数是：</p>
<p><span class="math inline">\(\mathbf q\mathbf p\mathbf q^{-1}| = \sqrt {1^{2} + \sqrt {2}^{2} + 1^{2} } = \sqrt {4} = 2\)</span></p>
<p>这和原始的p的范数一致。</p>
<p>下面的图像展示了旋转结果：</p>
<figure>
<img src="https://www.qiujiawei.com/images/2015.9/9.png" alt="" /><figcaption>9.png</figcaption>
</figure>
<p>所以我们可以看到，这个结果是一个纯四元数，并且原四元数的向量的范数也保持住了。但是还有一个问题：向量被旋转了90度而不是45度。这刚好是我们需要的度数的两倍！为了正确地让一个向量绕某个轴向量旋转某个角度，我们必须以目标角度的一半来计算。因此，我们构造了下面的四元数：</p>
<p><span class="math inline">\(q = [cos\frac {1}{2}\theta ,sin\frac {1}{2}\theta \mathbf { \hat { \mathbf v } }]\)</span></p>
<p>这就是<strong>旋转四元数</strong>的一般形式！</p>
<h2 id="四元数插值">四元数插值</h2>
<p>在计算机图形学中使用四元数，其中一个重要原因是四元数非常适合用来表示空间中的旋转。四元数解决了其他3维空间旋转算法会遇到的恼人的问题，比如使用欧拉角来表示旋转操作时会遇到的万向节锁问题(<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Gimbal_lock">Gimbal lock</a>)。</p>
<p>使用四元数，我们可以定义好几种方案来表示3维空间的转动插值。第一种是SLERP，它被用来把一个点(物体)从一个朝向平滑地插值到另一个朝向。第二个是SLERP的扩展版本，被称为SQAD，它被用来处理用一系列朝向定义得到的一条路径的插值。</p>
<h2 id="slerp">SLERP</h2>
<p>SLERP代表<strong>S</strong>pherical <strong>L</strong>inear Int<strong>erp</strong>olation。SLERP可以在2个朝向之间平滑地插值。第一个朝向设为q_{1}，第二个朝向设为q_{2} (请记住，这2个指示朝向的四元数是单位四元数，不然阅读下文会混乱）。被插值前的点设为<span class="math inline">\(\mathbf {p}\)</span>，插值后的点设为<span class="math inline">\(\mathbf {p}&#39;\)</span>。而插值参数t，当t=0时会把<span class="math inline">\(\mathbf {p}\)</span>转到<span class="math inline">\(q_{1}\)</span>，当t=1时会转到<span class="math inline">\(q_{2}\)</span>。</p>
<p>标准的线性插值公式是(译注：这个公式是笛卡尔坐标系下的，不是指四元数)：</p>
<p><span class="math inline">\(\mathbf {p}&#39; = \mathbf {p}_{1} + t(\mathbf {p}_{2} - \mathbf {p}_{1} )\)</span></p>
<p>应用这个等式的一般步骤是：</p>
<ul>
<li>计算<span class="math inline">\(\mathbf {p}_{1} 、\mathbf {p}_{2}\)</span>之间的差。</li>
<li>根据参数t，计算两个点的差的小数值(因为0&lt;=t&lt;=1)</li>
<li>把第二步的值加上原始点的值，算出结果</li>
</ul>
<p>我们可以把这个基础公式，套用到2个用四元数表示的朝向的插值上。</p>
<h3 id="四元数的差">四元数的差</h3>
<p>根据上面的公式的第一步，我们必须先计算q_{1}、 q_{2}的差。对于四元数来说，这等价于计算2个四元数的角度差(<strong>angular difference</strong>)：</p>
<p><span class="math inline">\(diff = \mathbf q_{1}^{-1}\mathbf q_{2}\)</span></p>
<p>（译注：由<span class="math inline">\(\mathbf q_{1}\mathbf p_{diff} = \mathbf q_{2}\)</span>推出 ）</p>
<h3 id="四元数的幂运算">四元数的幂运算</h3>
<p>接下来的目标是干掉上面四元数的差的分数部分，方法是计算四元数的t次幂(就是上面的那个插值参数t，区间是[0,1])。</p>
<p>四元数的幂运算的一般化公式是：</p>
<p>q^{t} = exp(t q)</p>
<p>其中，(纯)四元数的exp函数的公式是：</p>
<p><span class="math inline">\(\begin{align}e^{\mathbf q}&amp;= exp(\mathbf q) \\ &amp;= exp([0,\theta \mathbf { \hat { \mathbf v } }])\\ &amp;= [cos\theta ,sin\theta \mathbf { \hat { \mathbf v } } ]\end{align}\)</span></p>
<p>(纯)四元数的对数公式是：</p>
<p><span class="math inline">\(\begin{align}\log \mathbf q &amp;= \log (cos\theta + sin \theta \mathbf { \hat {\mathbf v} })\\ &amp;= \log (exp(\theta \mathbf { \hat { \mathbf v } } )) \\ &amp;= \theta \mathbf { \hat { \mathbf v } }\\ &amp;= [0, \theta \mathbf { \hat { \mathbf v } }]\end{align}\)</span></p>
<p>(译注：上述的2次公式推导，其实省略了很多证明过程。具体可以参考： <a target="_blank" rel="noopener" href="http://www.qiujiawei.com/quaternion2/">四元数公式的补充</a> )</p>
<p>对于t = 0，我们有： <span class="math display">\[\begin{align}q^{0}&amp; = exp(0\log \mathbf q) \\ &amp;= exp([cos(0), sin(0)\mathbf { \hat { \mathbf v } }]) \\&amp;= exp([1,\mathbf {0}]) \\&amp;= [1,\mathbf {0}]\end{align}\]</span></p>
<p>而对于t = 1，有：</p>
<p><span class="math inline">\(\mathbf q^{1} = exp(1\log \mathbf q) = \mathbf q\)</span></p>
<h3 id="个四元数的分数差">2个四元数的分数差</h3>
<p>对于角旋转的插值计算，我们利用q1和q2的角度分数差来调整原始朝向q1：</p>
<p><span class="math inline">\(\mathbf q&#39; = \mathbf q_{1}(\mathbf q_{1}^{-1}\mathbf q_{2})^{t}\)</span></p>
<p>这也就是使用四元数的球面线性插值的一般形式。然而，这不是slerp函数的常用形式。</p>
<p>我们可以应用类似的用于计算向量的球面插值公式，到四元数里。计算向量的球面插值的一般形式定义如下：</p>
<p><span class="math inline">\(\begin{align}\mathbf v_{t} = \frac {sin((1-t)\theta )}{sin\theta }\mathbf v_{1} + \frac {sin(t\theta )}{sin\theta }\mathbf v_{2}\end{align}\)</span></p>
<p>用图像表示如下：</p>
<figure>
<img src="https://www.qiujiawei.com/images/2015.9/10.png" alt="" /><figcaption>10.png</figcaption>
</figure>
<p>这个公式可以原封不动地应用到四元数：</p>
<p><span class="math inline">\(\mathbf q_{t} = \frac {sin((1-t)\theta )}{sin\theta }\mathbf q_{1} + \frac {sin(t\theta )}{sin\theta }\mathbf q_{2}\)</span></p>
<p>但这个公式需要提供角度<span class="math inline">\(\theta\)</span>，我们可以计算<span class="math inline">\(\mathbf q_{1}\)</span>和<span class="math inline">\(\mathbf q_{2}\)</span>的点积从而得出角度<span class="math inline">\(\theta\)</span>：</p>
<p><span class="math display">\[cos\theta = \frac {\mathbf q_{1}\cdot \mathbf q_{2}}{ | \mathbf q_{1} || \mathbf q_{2}| }\\cos\theta = \frac {s_{1}s_{2}+x_{1}x_{2}+y_{1}y_{2}+z_{1}z_{2}}{|\mathbf q_{1}||\mathbf q_{2}|}\\\theta = cos^{-1}(\frac {s_{1}s_{2}+x_{1}x_{2}+y_{1}y_{2}+z_{1}z_{2}}{|\mathbf q_{1}||\mathbf q_{2}|})\]</span></p>
<h3 id="注意事项">注意事项</h3>
<p>这个方案有2个问题，必须在实现过程中加以考虑。</p>
<p>第一，如果四元数点积的结果是负值，那么后面的插值就会在4D球面上绕远路，这并不是我们想要的。为了解决这个问题，我们测试点积的结果，当结果是负值时，我们将2个四元数的其中一个取反，取反它的系数和向量部分，并不会改变它代表的朝向。而经过这一步操作，可以保证这个旋转走的是最短路径。</p>
<p>当q_{1}和q_{2}的角度差非常小，小到导致sin= 0 时，会出现第二个问题。如果这个情况出现了，当我们除以sin。在这个情况下，我们可以回退去使用<span class="math inline">\(\mathbf q_{1}\)</span>和<span class="math inline">\(\mathbf q_{2}\)</span>的线性插值。</p>
<h2 id="squad">SQUAD</h2>
<p>正如一个SLERP可以被用来计算四元数之间的插值，一个SQUAD (<strong>S</strong>pherical and <strong>Quad</strong>rangle)可以被用来对旋转路径进行平滑插值。</p>
<p>如果我们有四元数序列：</p>
<p><span class="math inline">\(\mathbf q_{1},\mathbf q_{2},\mathbf q_{3},\cdots,\mathbf q_{n-2},\mathbf q_{n-1},\mathbf q_{n}\)</span></p>
<p>然后我们再定义一个"辅助"四元数(s_{i})，它是一个中间控制点：</p>
<p><span class="math inline">\(s_{i} = exp( - \frac {\log(\mathbf q_{i+1}\mathbf q_{i}^{-1})+\log(\mathbf q_{i-1}\mathbf q_{i}^{-1})}{4})\mathbf q_{i}\)</span></p>
<p>所以，沿着子曲线的朝向可以定义为：</p>
<p><span class="math inline">\(\mathbf q_{i-1},\mathbf q_{i},\mathbf q_{i+1},\mathbf q_{i+2}\)</span></p>
<p>在t时刻的朝向就是：</p>
<p><span class="math inline">\(squad(\mathbf q_{i}, \mathbf q_{i+1}, s_{i}, s_{i+1}, t ) = slerp(slerp(\mathbf q_{i}, \mathbf q_{i+1},t),slerp(s_{i},s_{i+1},t),2t(1-t))\)</span></p>
<h2 id="总结">总结</h2>
<p>除了特别难理解之外，相比矩阵或欧拉角，四元数在表示旋转这个事情上，拥有一些明显的优点。</p>
<ul>
<li>SLERP和SQUAD，提供了一种使得在朝向之间可以平滑过渡的方法。</li>
<li>使用四元数来串联"旋转"，要比使用矩阵快得多。</li>
<li>对于单位四元数，逆向旋转可以通过对向量部分取反来实现。而计算一个矩阵的逆矩阵是被认为比较慢的，如果这个矩阵未被标准正交化的话(标准正交矩阵的逆矩阵是它的转置矩阵)。</li>
<li>从四元数转换到矩阵，要比从欧拉角转换到矩阵快一点。</li>
<li>四元数只需要4个数字(如果旋转四元数已经单位化了那么只需要3个，实数部分可以在运行时计算)来表示一个旋转，而矩阵需要至少9个数字。</li>
</ul>
<p>尽管使用四元数有这么多优点，还是有缺点存在的。</p>
<ul>
<li>因为浮点数的舍入运算错误，四元数可能会变无效。不过，这个错误可以通过重新单位化四元数来避免。</li>
<li>使用四元数最具威慑性的地方，还是四元数的理解难度大。我希望这个问题可以通过阅读本文来解决。</li>
</ul>
<p>存在一些已经实现了四元数、并且是正确的的数学程序库。在我的个人经验里，我发现GLM(OpenGL Math Library)是一个优秀的数学库，它的四元数的实现极其不错。如果你对在你的程序中使用四元数感兴趣，那么我会推荐你使用这个数学库。</p>
<h2 id="下载demo">下载Demo</h2>
<p>我实现了一个小demo来演示一个四元数如何被用来旋转一个3维物体。这个demo是用Unity3.5.2实现的，你可以免费下载它和阅读它的脚本。zip文件也包含了一个Windows版的Unity程序。当然你可以自己构建一个Mac的版本。</p>
<p><a target="_blank" rel="noopener" href="https://docs.google.com/open?id=0B0ND0J8HHfaXdzM0dmdGUzBLV1U">Understanding Quaternions.zip</a></p>
<p><a target="_blank" rel="noopener" href="https://www.qiujiawei.com/understanding-quaternions/">原文链接</a></p>
<p><a target="_blank" rel="noopener" href="https://www.3dgep.com/understanding-quaternions/">英文全文链接</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ZYMIN</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zymin.cn/arcticle/understanding-quaternions.html">https://zymin.cn/arcticle/understanding-quaternions.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zymin.cn" target="_blank">ZYMIN</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E5%AD%A6/">数学</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/arcticle/Perspective-Matrix.html"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">透视矩阵Perspective Matrix</div></div></a></div><div class="next-post pull-right"><a href="/arcticle/Linear-algebra-translation-scaling-rotation-matrix.html"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">线性代数之平移、缩放、旋转矩阵</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/arcticle/Mathematica.html" title="Mathematica核心内容提示"><img class="cover" src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-12-29</div><div class="title">Mathematica核心内容提示</div></div></a></div><div><a href="/arcticle/Linear-algebra-translation-scaling-rotation-matrix.html" title="线性代数之平移、缩放、旋转矩阵"><img class="cover" src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-05</div><div class="title">线性代数之平移、缩放、旋转矩阵</div></div></a></div><div><a href="/arcticle/Perspective-Matrix.html" title="透视矩阵Perspective Matrix"><img class="cover" src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-05</div><div class="title">透视矩阵Perspective Matrix</div></div></a></div><div><a href="/arcticle/fourier-analysis.html" title="傅里叶分析理解"><img class="cover" src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-05-04</div><div class="title">傅里叶分析理解</div></div></a></div><div><a href="/arcticle/understand-matrix-mengyan.html" title="理解矩阵-孟岩Blog"><img class="cover" src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-14</div><div class="title">理解矩阵-孟岩Blog</div></div></a></div><div><a href="/arcticle/3d-print-simulation.html" title="3D打印仿真软件"><img class="cover" src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-06-01</div><div class="title">3D打印仿真软件</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">复数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%95%B0%E7%9A%84%E5%8A%A0%E5%87%8F"><span class="toc-number">2.1.</span> <span class="toc-text">复数的加减</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%95%B0%E7%9A%84%E7%B3%BB%E6%95%B0%E7%BC%A9%E6%94%BE"><span class="toc-number">2.2.</span> <span class="toc-text">复数的系数缩放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%95%B0%E7%9A%84%E7%A7%AF"><span class="toc-number">2.3.</span> <span class="toc-text">复数的积</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%95%B0%E7%9A%84%E5%B9%B3%E6%96%B9"><span class="toc-number">2.4.</span> <span class="toc-text">复数的平方</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B1%E8%BD%AD%E5%A4%8D%E6%95%B0"><span class="toc-number">2.5.</span> <span class="toc-text">共轭复数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%95%B0%E7%9A%84%E7%BB%9D%E5%AF%B9%E5%80%BC"><span class="toc-number">2.6.</span> <span class="toc-text">复数的绝对值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E5%A4%8D%E6%95%B0%E7%9A%84%E5%95%86"><span class="toc-number">2.7.</span> <span class="toc-text">两复数的商</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#i%E7%9A%84%E5%B9%82"><span class="toc-number">3.</span> <span class="toc-text">i的幂</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E6%95%B0%E5%B9%B3%E9%9D%A2"><span class="toc-number">4.</span> <span class="toc-text">复数平面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E6%95%B0rotors"><span class="toc-number">4.1.</span> <span class="toc-text">旋转数（Rotors)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">四元数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%BA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%9A%84%E5%9B%9B%E5%85%83%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">作为有序数的四元数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E5%8A%A0%E5%87%8F"><span class="toc-number">5.2.</span> <span class="toc-text">四元数的加减</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E7%A7%AF"><span class="toc-number">5.3.</span> <span class="toc-text">四元数的积</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E5%9B%9B%E5%85%83%E6%95%B0"><span class="toc-number">5.4.</span> <span class="toc-text">实四元数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E7%B3%BB%E6%95%B0%E7%BC%A9%E6%94%BE"><span class="toc-number">5.5.</span> <span class="toc-text">四元数的系数缩放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%AF%E5%9B%9B%E5%85%83%E6%95%B0"><span class="toc-number">5.6.</span> <span class="toc-text">纯四元数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E5%8A%A0%E6%B3%95%E5%BD%A2%E5%BC%8F"><span class="toc-number">5.7.</span> <span class="toc-text">四元数的加法形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BD%8D%E5%9B%9B%E5%85%83%E6%95%B0"><span class="toc-number">5.8.</span> <span class="toc-text">单位四元数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E4%BA%8C%E5%85%83%E5%BD%A2%E5%BC%8F"><span class="toc-number">5.9.</span> <span class="toc-text">四元数的二元形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B1%E8%BD%AD%E5%9B%9B%E5%85%83%E6%95%B0"><span class="toc-number">5.10.</span> <span class="toc-text">共轭四元数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E8%8C%83%E6%95%B0"><span class="toc-number">5.11.</span> <span class="toc-text">四元数范数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E8%A7%84%E8%8C%83%E5%8C%96"><span class="toc-number">5.12.</span> <span class="toc-text">四元数规范化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E9%80%86"><span class="toc-number">5.13.</span> <span class="toc-text">四元数的逆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E7%82%B9%E7%A7%AF"><span class="toc-number">5.14.</span> <span class="toc-text">四元数的点积</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC"><span class="toc-number">6.</span> <span class="toc-text">旋转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E6%8F%92%E5%80%BC"><span class="toc-number">7.</span> <span class="toc-text">四元数插值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#slerp"><span class="toc-number">8.</span> <span class="toc-text">SLERP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E5%B7%AE"><span class="toc-number">8.1.</span> <span class="toc-text">四元数的差</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E5%B9%82%E8%BF%90%E7%AE%97"><span class="toc-number">8.2.</span> <span class="toc-text">四元数的幂运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AA%E5%9B%9B%E5%85%83%E6%95%B0%E7%9A%84%E5%88%86%E6%95%B0%E5%B7%AE"><span class="toc-number">8.3.</span> <span class="toc-text">2个四元数的分数差</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">8.4.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#squad"><span class="toc-number">9.</span> <span class="toc-text">SQUAD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">10.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDdemo"><span class="toc-number">11.</span> <span class="toc-text">下载Demo</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/arcticle/huawei-yipengchuan.html" title="非华为电脑安装最新版本华为电脑管家实现多屏协同+一碰传教程">非华为电脑安装最新版本华为电脑管家实现多屏协同+一碰传教程</a><time datetime="2021-02-24T10:28:46.000Z" title="发表于 2021-02-24 18:28:46">2021-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/arcticle/biba.html" title="比巴M11P上传音频到机器的方法">比巴M11P上传音频到机器的方法</a><time datetime="2021-01-30T02:30:06.000Z" title="发表于 2021-01-30 10:30:06">2021-01-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/arcticle/markdown-rumen.html" title="markdown快速入门">markdown快速入门</a><time datetime="2020-09-20T06:27:57.000Z" title="发表于 2020-09-20 14:27:57">2020-09-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/arcticle/photoshop-qianming.html" title="Photoshop制作电子签名">Photoshop制作电子签名</a><time datetime="2020-09-20T06:24:08.000Z" title="发表于 2020-09-20 14:24:08">2020-09-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/arcticle/freefilesync.html" title="Windows离线文件同步和备份-Freefilesync">Windows离线文件同步和备份-Freefilesync</a><time datetime="2020-09-20T05:54:01.000Z" title="发表于 2020-09-20 13:54:01">2020-09-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/zzhm/resource@main/image/fengmian3.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2016 - 2021 By ZYMIN</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadWaline () {
  function initWaline () {
    let initData = {
      el: '#waline-wrap',
      serverURL: 'https://waline-15iowqrgj.vercel.app/',
      avatar: 'monsterid',
      path: location.pathname,
      emojiCDN: '',
      emojiMaps: "",
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const waline = new Waline(initData)
  }

  if (typeof Waline === 'function') initWaline() 
  else getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js').then(initWaline)
}

if ('Waline' === 'Waline' || !false) {
  if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script async data-pjax src="https://cdn.jsdelivr.net/gh/zzhm/resource@main/js/busuanzi.pure.mini.js"></script></div></body></html>